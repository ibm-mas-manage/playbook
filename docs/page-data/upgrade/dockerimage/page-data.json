{"componentChunkName":"component---src-pages-upgrade-dockerimage-mdx","path":"/upgrade/dockerimage/","result":{"pageContext":{"frontmatter":{"title":"Manageadmin Docker Image"},"relativePagePath":"/upgrade/dockerimage.mdx","titleType":"append","MdxNode":{"id":"e6c146e8-25b7-52e2-8555-5cedbbee044a","children":[],"parent":"db56e639-112a-5b98-93d5-6ccda7469b5f","internal":{"content":"---\ntitle: Manageadmin Docker Image\n---\n\n## Get the Manage admin docker image \n\nUse the following steps to retrieve the Manageadmin image:\n- oc login\n\n```\n$ oc login --token=sha256~yLcd9N_ih1UX7tGcq9REywmoliEGvK4R-rtDu_xxxxx --server=https://api.mas-app-sb123.cp.fyre.ibm.com:6443\n```\n\n- Expose the internal registry to external using Route\n\n```\n$ oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{\"spec\":{\"defaultRoute\":true}}' --type=merge\n```\n- Verify the internal registry route hostname\n\n```\n$ oc get route -n openshift-image-registry\n\nNAME            HOST/PORT                                                                PATH  SERVICES        PORT      TERMINATION      WILDCARD\ndefault-route   default-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com         image-registry  all       reencrypt        None\nimage-registry  image-registry.openshift-image-registry.svc                                     image-registry  5000-tcp  reencrypt        None\n```\n\n- Login using the default registry route hostname\n\n- docker login -u `<user_name>` -p $(oc whoami -t) default-route-openshift-image-registry.apps.`<clustername>`.`<basedomain>`\n\n```\n$ sudo docker login -u kubeadmin -p $(oc whoami -t) https://default-route-openshift-image-registry.apps.mas-app-sb123.cp.fyre.ibm.com\n```\n- If you get \"x509: certificate signed by unknown authority\" error message, then you should place the Router trusted CA on your host.\n   \n- Extract the CA from Red Hat OCP cluster, where registry is configured\n\n```\n$ oc extract secret/router-ca --keys=tls.crt -n openshift-ingress-operator\n```\n- Perform on the node, where the image pulling throws x509 error.\n\n```\n$ sudo cp tls.crt /usr/local/share/ca-certificates/.\n$ sudo update-ca-certificates\n```\n  \n- Make sure docker daemon is running.\n\n```\n$ ps -aux | grep dockerd\n\nroot       203  0.0  0.0  10508  4232 pts/0    T    01:28   0:00 sudo dockerd\nroot      2397  0.0  0.0  11016  4612 pts/1    S    16:49   0:00 sudo dockerd\nroot      2398  0.0  0.4 1538160 111260 pts/1  Sl   16:49   0:07 dockerd\nsarika    3999  0.0  0.0   8160   724 pts/1    S+   23:26   0:00 grep --color=auto dockerd\n```\n\n- Pull admin docker latest image:\n  docker pull `<Public image Repository>`\n  From the Manage project in OpenShift console, get the `Public Image Repository` value from the `<instanceid>`-`<workspaceid>`-admin in ImageStreams under Builds.\n\n![image](images/imagestream.png)\n\n<p></p>\n\n```\n$ sudo docker pull `default-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com/mas-sb1-manage/sb1-masdev-admin`\n```\n\n- Get Image ID:\n  docker images\n```\n$ sudo docker images\n\nREPOSITORY                                                                                               TAG      IMAGE ID      CREATED      SIZE\ndefault-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com/mas-sb1-manage/sb1-masdev-admin  latest   c0e655398e6b  3 weeks ago  7.87GB\n```\n\n- Run the docker pulled admin image \n  docker run -d `<image id>`\n```\n$ sudo docker run -d c0e655398e6b\n\n1f2dfad8d3c813792798dc1f220bf27b7935f604c4817f47346a1f96e2336a92\ntime=\"2021-06-26T16:54:46.067182200-04:00\" level=info msg=\"starting signal loop\" namespace=moby path=/run/docker/containerd/daemon/io.containerd.runtime.v2.task/moby/1f2dfad8d3c813792798dc1f220bf27b7935f604c4817f47346a1f96e2336a92 pid=2832\n```\n\n- Get the container id for the pulled admin image.\n  docker ps -a\n```\nsudo docker ps -a\n\nCONTAINER ID  IMAGE         COMMAND           CREATED     STATUS   PORTS    NAMES\nd3544a11901e  c0e655398e6b  \"/entrypoint.sh\"  6 days ago  Created            boring_hopper\n```\n\n- Copy the Manage code locally. \n\n```\n$ sudo docker cp d3544a11901e:/opt/IBM/SMP/maximo/latest.zip /mnt/c/temp/.\n```\n\n- You can also run tools such as integrity checker.\n    - docker exec -it `<container id>` /bin/bash\n    - Update the maximo properties in /opt/IBM/SMP/maxio/applications/maximo/properties folder.\n    - Execute /opt/IBM/SMP/maxio/applications/maximo/validate_integ.sh\n","type":"Mdx","contentDigest":"6eeb3377d57e22a1e3c65fcec5d5981f","owner":"gatsby-plugin-mdx","counter":206},"frontmatter":{"title":"Manageadmin Docker Image"},"exports":{},"rawBody":"---\ntitle: Manageadmin Docker Image\n---\n\n## Get the Manage admin docker image \n\nUse the following steps to retrieve the Manageadmin image:\n- oc login\n\n```\n$ oc login --token=sha256~yLcd9N_ih1UX7tGcq9REywmoliEGvK4R-rtDu_xxxxx --server=https://api.mas-app-sb123.cp.fyre.ibm.com:6443\n```\n\n- Expose the internal registry to external using Route\n\n```\n$ oc patch configs.imageregistry.operator.openshift.io/cluster --patch '{\"spec\":{\"defaultRoute\":true}}' --type=merge\n```\n- Verify the internal registry route hostname\n\n```\n$ oc get route -n openshift-image-registry\n\nNAME            HOST/PORT                                                                PATH  SERVICES        PORT      TERMINATION      WILDCARD\ndefault-route   default-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com         image-registry  all       reencrypt        None\nimage-registry  image-registry.openshift-image-registry.svc                                     image-registry  5000-tcp  reencrypt        None\n```\n\n- Login using the default registry route hostname\n\n- docker login -u `<user_name>` -p $(oc whoami -t) default-route-openshift-image-registry.apps.`<clustername>`.`<basedomain>`\n\n```\n$ sudo docker login -u kubeadmin -p $(oc whoami -t) https://default-route-openshift-image-registry.apps.mas-app-sb123.cp.fyre.ibm.com\n```\n- If you get \"x509: certificate signed by unknown authority\" error message, then you should place the Router trusted CA on your host.\n   \n- Extract the CA from Red Hat OCP cluster, where registry is configured\n\n```\n$ oc extract secret/router-ca --keys=tls.crt -n openshift-ingress-operator\n```\n- Perform on the node, where the image pulling throws x509 error.\n\n```\n$ sudo cp tls.crt /usr/local/share/ca-certificates/.\n$ sudo update-ca-certificates\n```\n  \n- Make sure docker daemon is running.\n\n```\n$ ps -aux | grep dockerd\n\nroot       203  0.0  0.0  10508  4232 pts/0    T    01:28   0:00 sudo dockerd\nroot      2397  0.0  0.0  11016  4612 pts/1    S    16:49   0:00 sudo dockerd\nroot      2398  0.0  0.4 1538160 111260 pts/1  Sl   16:49   0:07 dockerd\nsarika    3999  0.0  0.0   8160   724 pts/1    S+   23:26   0:00 grep --color=auto dockerd\n```\n\n- Pull admin docker latest image:\n  docker pull `<Public image Repository>`\n  From the Manage project in OpenShift console, get the `Public Image Repository` value from the `<instanceid>`-`<workspaceid>`-admin in ImageStreams under Builds.\n\n![image](images/imagestream.png)\n\n<p></p>\n\n```\n$ sudo docker pull `default-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com/mas-sb1-manage/sb1-masdev-admin`\n```\n\n- Get Image ID:\n  docker images\n```\n$ sudo docker images\n\nREPOSITORY                                                                                               TAG      IMAGE ID      CREATED      SIZE\ndefault-route-openshift-image-registry.apps.mas-app-sb1.cp.fyre.ibm.com/mas-sb1-manage/sb1-masdev-admin  latest   c0e655398e6b  3 weeks ago  7.87GB\n```\n\n- Run the docker pulled admin image \n  docker run -d `<image id>`\n```\n$ sudo docker run -d c0e655398e6b\n\n1f2dfad8d3c813792798dc1f220bf27b7935f604c4817f47346a1f96e2336a92\ntime=\"2021-06-26T16:54:46.067182200-04:00\" level=info msg=\"starting signal loop\" namespace=moby path=/run/docker/containerd/daemon/io.containerd.runtime.v2.task/moby/1f2dfad8d3c813792798dc1f220bf27b7935f604c4817f47346a1f96e2336a92 pid=2832\n```\n\n- Get the container id for the pulled admin image.\n  docker ps -a\n```\nsudo docker ps -a\n\nCONTAINER ID  IMAGE         COMMAND           CREATED     STATUS   PORTS    NAMES\nd3544a11901e  c0e655398e6b  \"/entrypoint.sh\"  6 days ago  Created            boring_hopper\n```\n\n- Copy the Manage code locally. \n\n```\n$ sudo docker cp d3544a11901e:/opt/IBM/SMP/maximo/latest.zip /mnt/c/temp/.\n```\n\n- You can also run tools such as integrity checker.\n    - docker exec -it `<container id>` /bin/bash\n    - Update the maximo properties in /opt/IBM/SMP/maxio/applications/maximo/properties folder.\n    - Execute /opt/IBM/SMP/maxio/applications/maximo/validate_integ.sh\n","fileAbsolutePath":"/home/travis/build/maximo/manage-playbook/src/pages/upgrade/dockerimage.mdx"}}},"staticQueryHashes":["1364590287","137577622","137577622","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550"]}